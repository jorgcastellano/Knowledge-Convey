jQuery(document).ready(function(a){function b(){a(".fields_panel").on("click",".header_service_row",function(){a(this).next().toggle("fast")}),a(".fields_panel").on("click",".header_service_row .remove",function(b){if(b.preventDefault(),confirm(yith_wcevti_tickets.messages.ask_for_delete_ticket+" "+yith_wcevti_tickets.messages.ticket),!0){var c=a(this).closest(".field_service_row");c.remove(),q(c),a(".quantity>input[type=number]").val(a(".field_service_row").length),void 0!==Cookies.get("quantity")&&Cookies.set("quantity",a(".quantity>input[type=number]").val(),{path:""}),n(),a(".field_service_row").each(function(b){0!=b&&j(a(this),b,!1)})}}),a(".fields_panel").on("change","input, select",function(){var b=a(this).closest(".field_service_row");0!=a(this).prev(".yith_wcevti_item_message_empty, .yith_wcevti_item_message_good").length&&(e(b)||u(b,"incomplete"))}),a(".single_add_to_cart_button").on("click",function(){d(),o()}),a(".fields_panel").find("._field_datepicker").datepicker({dateFormat:"mm/dd/yy",changeMonth:!0,changeYear:!0});var b=void 0!==Cookies.get("quantity")?Cookies.get("quantity"):1;a(".quantity>input[type=number]").val(b),a(".quantity>input[type=number]").change(i),a(".quantity>input[type=number]").trigger("change")}function c(){a(".fields_panel").on("change","._select_item",k),a("._select_item").trigger("change"),a("._select_item").prev(".yith_wcevti_item_message").remove(),a(".fields_panel").on("change",".checkbox",function(b){var c=a(this).closest(".service_panel");a(this).is(":checked")?$overchage=parseFloat(a(this).attr("data-overcharge")):$overchage=parseFloat(0),m(c,$overchage)}),a(".checkbox").trigger("change")}function d(){a(".field_service_row").each(function(b){if(!e(a(this)))return a(this).find(".content_service_row").toggle(!0),u(this,"incomplete"),!1})}function e(b){var c=!0;return b.find(":input[required], select[required]").each(function(b){switch(a(this).prop("tagName").toLocaleLowerCase()){case"input":c=!!f(this)&&c;break;case"select":c=!!g(this)&&c}}),c}function f(b){var c=!0,d=a(b).attr("type");switch(c=!!h(b)&&c,d){case"email":if(c){c=!!RegExp(/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i).test(a(b).val())&&c,c?v(a(b),"good"):v(a(b),"wrong_mail")}else v(a(b),"empty");break;case"number":c?(c=!!a.isNumeric(a(b).val())&&c,c?v(a(b),"good"):v(a(b),"wrong_number")):v(a(b),"empty");break;case"date":if(c){var f=Date.parse(a(b).val());if(!(c=!!f&&c)){var g=a(b).val().split("/"),i=g[2]+"-"+g[1]+"-"+g[0];f=Date.parse(i),c=!!f||c}c?v(a(b),"good"):v(a(b),"wrong_date")}else v(a(b),"empty");break;default:c?v(b,"good"):v(b,"empty")}return c}function g(b){var c=!0;return a(b).is(":disabled")?(a(b).val(""),c=!1):c=!!h(b)&&c,c?v(a(b),"good"):v(a(b),"empty"),c}function h(b){var c=!0;return null!=a(b).val()?c=0!==a(b).val().length&&c:(a(b).val(""),c=!1),c}function i(){var b=a(this).val()-a(".field_service_row").length;if(b>=0){a(".cart").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});for(var c=0;c<b;c++){var d=a(".field_service_row").length,e=a(".field_service_row").first().clone();e=j(e,d,!0),a(".fields_panel").append(e),e.find(".content_service_row").toggle(!0)}a(".field_service_row .remove").show(),a(".field_service_row .remove").first().hide(),n(),a(".cart").unblock(),t()}else 0!=b&&(confirm(yith_wcevti_tickets.messages.ask_for_delete_ticket+" "+-1*b+" "+yith_wcevti_tickets.messages.tickets),void 0!==Cookies.get("quantity")&&t(),l(b))}function j(b,c,d){b.find("input, select, textarea").each(function(b){var e=a(this).attr("name"),f=/customer\[\d+]/;if(void 0!==e){e=e.replace(f,"customer["+c+"]"),a(this).attr("name",e);var g=a(this).attr("id");if(void 0!==g){var h=/customer_\d+/;g=g.replace(h,"customer_"+c),h=/customer\[\d+]/,g=g.replace(h,"customer["+c+"]"),a(this).attr("id",g)}"hidden"!==a(this).attr("type")&d&&a(this).val("")}}),b.find("label").each(function(b){var d=a(this).attr("for"),e=/customer_\d+/;d=d.replace(e,"customer_"+c),e=/customer\[\d+]/,d=d.replace(e,"customer["+c+"]"),a(this).attr("for",d)});var e=b.find(".header_service_row>h3").text();return e=e.slice(0,e.indexOf("#")+1),b.find(".header_service_row>h3").text(e+(c+1)),w(b),b}function k(){var b=a(this).find(":selected"),c=a(this).closest(".service_panel"),d=c.find("._services_customer_"+b.attr("name")+"_field"),e=parseFloat(a("option:selected",this).data("overcharge"));c.find(".service_range>.select_range").prop("required",!1),c.find(".service_range").hide(),a(d).find(".yith_wcevti_item_message").remove(),a(d).find(".select_range").prop("required",!0),d.show(),d.hasClass("service_range")&&d.find(".select_range").trigger("change"),m(c,e)}function l(b){b*=-1;var c=a(".field_service_row").length-b;a(".field_service_row").each(function(b,d){b>0&b>=c&&(q(a(d)),d.remove())}),n()}function m(b,c){$price_service=parseFloat(a(b).attr("data-price_service")),$overchage=parseFloat(c),$total_price=parseFloat(a(".yith_evti_total_price").attr("data-current_price")),$total_price-=$price_service,$total_price+=$overchage,a(".yith_evti_total_price").attr("data-current_price",$total_price),a(b).attr("data-price_service",$overchage),$last_price_content=a(".yith_evti_total_price>.price>.woocommerce-Price-amount").contents().last(),$last_price_content.hasClass("woocommerce-Price-currencySymbol")?a(".yith_evti_total_price>.price>.woocommerce-Price-amount").contents().first().replaceWith($total_price.toFixed(2)):a(".yith_evti_total_price>.price>.woocommerce-Price-amount").contents().last().replaceWith($total_price.toFixed(2)),a(document).trigger("yith_wcevti_price_refreshed",[$total_price.toFixed(2)])}function n(){$base_price=yith_wcevti_tickets.product.price,$num_tickets=parseFloat(a(".quantity>input[type=number]").val()),$total_price=$base_price*$num_tickets,a(".yith_evti_total_price").attr("data-current_price",$total_price),a(".service_panel").attr("data-price_service",0),a("._select_item").trigger("change"),a(".checkbox").trigger("change"),$last_price_content=a(".yith_evti_total_price>.price>.woocommerce-Price-amount").contents().last(),$last_price_content.hasClass("woocommerce-Price-currencySymbol")?a(".yith_evti_total_price>.price>.woocommerce-Price-amount").contents().first().replaceWith($total_price.toFixed(2)):a(".yith_evti_total_price>.price>.woocommerce-Price-amount").contents().last().replaceWith($total_price.toFixed(2)),a(document).trigger("yith_wcevti_price_refreshed",[$total_price.toFixed(2)])}function o(){a(".field_service_row").each(function(b){p(a(this))}),Cookies.set("quantity",a(".quantity>input[type=number]").val(),{path:""})}function p(a){a.find("input, select, textarea").each(function(a){r(this)})}function q(a){a.find("input, select, textarea").each(function(a){s(this)})}function r(b){if("hidden"!==a(b).attr("type")){var c=a(b).attr("name"),d=a(b).val();switch(a(b).attr("type")){case"checkbox":d=a(b).prop("checked")}Cookies.set(c,d,{path:""})}}function s(b){Cookies.remove(a(b).attr("name"),{path:""})}function t(){a(".field_service_row").each(function(b){a(this).find("input, select, textarea").each(function(b){var c=Cookies.get(a(this).attr("name"));if(void 0!==c)switch(a(this).attr("type")){case"checkbox":var c="true"===c;a(this).prop("checked",c);break;default:a(this).val(c)}h(this)&"hidden"!==a(this).attr("type")&&a(this).closest(".form-field").show()})}),void 0!==Cookies.get("quantity")&&Cookies.set("quantity",a(".quantity>input[type=number]").val(),{path:""})}function u(b,c){var d=a(b).closest(".field_service_row").find(".service_message");switch(d.empty(),c){case"complete":var e=a("<span/>").addClass("fa fa-check yith_wcevti_item_message yith_wcevti_item_message_complete").text(" "+yith_wcevti_tickets.messages.complete_field_service);a(b).closest(".field_service_row").removeClass("yith_wcevti_item_panel_unstyle yith_wcevti_item_panel_incomplete"),a(b).closest(".field_service_row").addClass("yith_wcevti_item_panel_complete"),e.appendTo(d);break;case"incomplete":var e=a("<span/>").addClass("fa fa-close yith_wcevti_item_message yith_wcevti_item_message_incomplete").text(" "+yith_wcevti_tickets.messages.incomplete_field_service);a(b).closest(".field_service_row").removeClass("yith_wcevti_item_panel_unstyle yith_wcevti_item_panel_complete"),a(b).closest(".field_service_row").addClass("yith_wcevti_item_panel_incomplete"),e.appendTo(d)}}function v(b,c){switch(a(b).prev(".yith_wcevti_item_message").remove(),$row=a(b).closest(".field_service_row").find(".service_message"),c){case"good":var d=a("<span/>").addClass("fa fa-check yith_wcevti_item_message yith_wcevti_item_message_good").text(" "+yith_wcevti_tickets.messages.complete_required_item);d.insertBefore(b),u($row,"complete");break;case"empty":var d=a("<span/>").addClass("fa fa-close yith_wcevti_item_message yith_wcevti_item_message_empty").text(" "+yith_wcevti_tickets.messages.incomplete_required_item);d.insertBefore(b),u($row,"incomplete");break;case"wrong_mail":var d=a("<span/>").addClass("fa fa-close yith_wcevti_item_message yith_wcevti_item_message_empty").text(" "+yith_wcevti_tickets.messages.wrong_mail_field);d.insertBefore(b),u($row,"incomplete");break;case"wrong_number":var d=a("<span/>").addClass("fa fa-close yith_wcevti_item_message yith_wcevti_item_message_empty").text(" "+yith_wcevti_tickets.messages.wrong_number_field);d.insertBefore(b),u($row,"incomplete");break;case"wrong_date":var d=a("<span/>").addClass("fa fa-close yith_wcevti_item_message yith_wcevti_item_message_empty").text(" "+yith_wcevti_tickets.messages.wrong_date_field);d.insertBefore(b),u($row,"incomplete");break;default:a(b).prev(".yith_wcevti_item_message").remove()}}function w(a){a.find(".yith_wcevti_item_message").text(""),a.find(".yith_wcevti_item_message").removeClass("fa fa-check fa-close yith_wcevti_item_message_incomplete yith_wcevti_item_message_complete"),a.removeClass("yith_wcevti_item_panel_complete"),a.addClass("yith_wcevti_item_panel_unstyle")}b(),c()});